{"name":"Encoder/Decoder Arabic-Context v1 (single-file HTML)","type":"code/html","content":"<!DOCTYPE html>\n<html lang="ar" dir="rtl">\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1" />\n  <title>توليد رموز خفية — تشفير وفك تشفير سياقي</title>\n  <style>\n    :root{\n      --bg:#0b0f14;--panel:#121821;--muted:#93a2b1;--text:#e6edf3;--accent:#5eead4;--accent-2:#8b5cf6;--danger:#ef4444;--ok:#22c55e;\n      --radius:18px;--shadow:0 10px 30px rgba(0,0,0,.35);\n    }\n    *{box-sizing:border-box}\n    html,body{height:100%}\n    body{margin:0;font-family:"Cairo", system-ui, -apple-system, Segoe UI, Roboto, Noto Sans Arabic, Arial, sans-serif;background:linear-gradient(135deg,#0b0f14 0%,#0e1320 50%,#0b0f14 100%);color:var(--text)}\n    .container{max-width:1080px;margin:32px auto;padding:0 16px}\n    .title{font-size:28px;display:flex;align-items:center;gap:10px;margin:0 0 6px}\n    .subtitle{margin:0 0 24px;color:var(--muted)}\n    .grid{display:grid;grid-template-columns:1fr;gap:16px}\n    @media(min-width:880px){.grid{grid-template-columns:1fr 1fr}}\n    .card{background:radial-gradient(1200px 400px at 100% -10%,rgba(94,234,212,.08),transparent 60%),radial-gradient(1000px 400px at -10% 110%,rgba(139,92,246,.08),transparent 60%),var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}\n    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}\n    textarea{width:100%;min-height:170px;background:#0b111a;color:var(--text);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px 14px;font-size:15px;line-height:1.6;outline:none;transition:.2s}\n    textarea:focus{border-color:rgba(94,234,212,.45);box-shadow:0 0 0 3px rgba(94,234,212,.15)}\n    .btn{appearance:none;border:none;border-radius:14px;padding:10px 14px;font-size:15px;background:#0f1623;color:var(--text);cursor:pointer;transition:.15s;border:1px solid rgba(255,255,255,.06)}\n    .btn:hover{transform:translateY(-1px);filter:brightness(1.1)}\n    .btn.primary{background:linear-gradient(135deg,var(--accent),#22d3ee);color:#061014}\n    .btn.secondary{background:linear-gradient(135deg,#a78bfa,#60a5fa);color:#0d1020}\n    .btn.ghost{background:transparent}\n    .badge{display:inline-flex;gap:8px;align-items:center;background:rgba(94,234,212,.12);color:var(--accent);border:1px solid rgba(94,234,212,.35);padding:6px 10px;border-radius:999px;font-size:13px}\n    .hint{font-size:13px;color:var(--muted)}\n    .mini{font-size:12px;color:var(--muted)}\n    .split{display:grid;grid-template-columns:1fr 1fr;gap:8px}\n    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:#0a0f17;border:1px solid rgba(255,255,255,.08);padding:2px 8px;border-radius:8px}\n    .pill{border-radius:999px;padding:2px 10px;border:1px dashed rgba(255,255,255,.15)}\n    .ok{color:var(--ok)}.danger{color:var(--danger)}\n  </style>\n  <link rel="preconnect" href="https://fonts.googleapis.com">\n  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>\n  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">\n</head>\n<body>\n  <div class="container">\n    <div class="row" style="justify-content:space-between;margin-bottom:8px">\n      <h1 class="title">🔐 توليد رموز خفية <span class="badge">تشفير سياقي + فك التشفير</span></h1>\n      <div class="pill mini">يعمل 100% بدون إنترنت — ملف واحد فقط</div>\n    </div>\n    <p class="subtitle">اكتب <b>اسم</b> أو <b>تاريخ ميلاد</b> وسيتم تحويله لرموز غامضة. الخوارزمية <b>سياقية</b>: الرمز قد يتغيّر حسب الحرف/الرقم السابق (مثال: <span class="kbd">19</span> يعطي رمزًا خاصًا لـ <b>9</b>، و<span class="kbd">هز</span> يعطي رمزًا خاصًا لـ <b>ز</b>). ويمكن فكها بسهولة بنفس الصفحة.</p>\n\n    <div class="grid">\n      <section class="card">\n        <h3 style="margin-top:0">🔄 التشفير → من نص إلى رموز</h3>\n        <textarea id="plain" placeholder="مثال: أنس 2008-12-31 أو هز أو 19"></textarea>\n        <div class="row" style="margin-top:10px">\n          <button class="btn primary" id="encodeBtn">تشفير (Encode)</button>\n          <button class="btn" id="copyCipher">نسخ الرموز</button>\n          <span class="hint">الناتج يكون عبارة عن <b>رموز مفصولة بمسافة</b> لسهولة فكّها.</span>\n        </div>\n        <textarea id="cipher" placeholder="الرموز تظهر هنا تلقائيًا بعد التشفير"></textarea>\n      </section>\n\n      <section class="card">\n        <h3 style="margin-top:0">🗝️ فك التشفير → من رموز إلى نص</h3>\n        <textarea id="cipherIn" placeholder="الصق الرموز (مفصولة بمسافات)"></textarea>\n        <div class="row" style="margin-top:10px">\n          <button class="btn secondary" id="decodeBtn">فك التشفير (Decode)</button>\n          <button class="btn" id="copyPlain">نسخ النص</button>\n          <span class="hint">تستطيع إرجاع النص الأصلي حتى مع الحالات السياقية (مثل 19 و هز).</span>\n        </div>\n        <textarea id="plainOut" placeholder="النص الأصلي يظهر هنا بعد فك التشفير"></textarea>\n      </section>\n    </div>\n\n    <section class="card" style="margin-top:16px">\n      <h3 style="margin-top:0">⚙️ تخصيص الأزواج السياقية (اختياري)</h3>\n      <div class="row">\n        <input id="pairPrev" class="btn ghost" maxlength="2" placeholder="الحرف/الرقم السابق" style="width:180px" />\n        <input id="pairCurr" class="btn ghost" maxlength="2" placeholder="الحرف/الرقم الحالي" style="width:180px" />\n        <button class="btn" id="addPair">إضافة زوج مخصّص</button>\n        <span class="hint">كل زوج يأخذ رمزًا خاصًا به ويُحفظ محليًا.</span>\n      </div>\n      <div id="pairsList" class="mini" style="margin-top:10px;color:#cbd5e1"></div>\n    </section>\n\n    <p class="mini" style="text-align:center;margin-top:12px;color:#9aa6b2">ملاحظة: الرموز المستخدمة ثابتة داخليًا لضمان إمكانية فك التشفير. يمكنك تعديل الملف وتغيير المجموعات كما تريد.</p>\n  </div>\n\n  <script>\n    // ====== إعداد الحروف والأرقام المسموحة ======\n    const ARABIC_LETTERS = [\n      "ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","ء","أ","إ","آ","ى","ة","ؤ","ئ"\n    ];\n    const DIGITS_AR = ["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"]; // أرقام عربية\n    const DIGITS_EN = ["0","1","2","3","4","5","6","7","8","9"]; // أرقام إنجليزية\n    const COMMON = [" ","-","/",".",":",",","؛","?","!","(",")"];\n\n    // ====== مجموعات الرموز: أساسية وزوجية (سياقية) ======\n    // يجب ألا تتداخل المجموعتان لضمان فك التشفير.\n    const BASE_SYMBOLS = [\n      "◆","◇","○","●","▲","△","▣","▢","■","□","◈","✦","✧","✪","✫","✬","✭","✮","✯","✰",\n      "✱","✲","✳","✴","❇","✺","✻","✼","✽","✾","✿","❀","❁","❂","❃","❄","❆","❇","❈","❉",\n      "❊","❋","☀","☁","☂","☃","☄","★","☆","☎","☘","☽","☾","♠","♡","♢","♣","♤","♥","♦","♧",\n      "⚑","⚐","⚙","⚡","☯","☮","☪","☣","☢","☸","♨","⌁","⌘","⎈","⌂","⌁","⍟","⌬","⍣","⍥","⎊","⎋"\n    ];\n\n    // رموز للأزواج السياقية، سنلفها بين قوسين خاصين لتمييزها: ⟦ ... ⟧\n    const PAIR_INNER_SYMBOLS = [\n      "❖","✜","✚","✛","✠","✣","✤","✥","✵","✶","✷","✸","✹","✺","✽","✾","✿","❀","❁","❂",\n      "❃","❄","❆","❇","❈","❉","❊","❋","✢","✣","✤","✥","✦","✧","✩","✪","✫","✬","✭","✮",\n      "✯","✰","✱","✲","✳","✴","✵","✶","✷","✸","✹","✺","✻","✼","✽"\n    ];\n\n    // ====== بناء الخرائط الأساسية تلقائيًا ======\n    const ALLOWED_CHARS = [...ARABIC_LETTERS, ...DIGITS_AR, ...DIGITS_EN, ...COMMON];\n\n    if (BASE_SYMBOLS.length < ALLOWED_CHARS.length) {\n      alert("عدد BASE_SYMBOLS غير كافٍ — أضف المزيد لضمان تغطية كل الأحرف.");\n    }\n\n    /**\n     * سننشئ خريطة أساسية حرف→رمز وخريطة عكسية رمز→حرف\n     */\n    const baseMap = new Map();\n    const baseReverse = new Map();\n    for (let i=0;i<ALLOWED_CHARS.length;i++){\n      const ch = ALLOWED_CHARS[i];\n      const sym = BASE_SYMBOLS[i % BASE_SYMBOLS.length];\n      baseMap.set(ch, sym);\n      baseReverse.set(sym, ch);\n    }\n\n    // ====== الأزواج السياقية (Overrides) ======\n    // الفكرة: عند وجود زوج (سابق+حالي) نضع للثاني رمزًا خاصًا: ⟦X⟧ حيث X من PAIR_INNER_SYMBOLS، ونحافظ على رمز السابق كما هو.\n    // أمثلة مطلوبة: "19" و "هز"\n    const defaultPairs = [\n      ["1","9"], // 19 → للـ 9 رمز خاص\n      ["ه","ز"], // هز → للـ ز رمز خاص\n    ];\n\n    function wrapPairSymbol(inner){ return ⟦${inner}⟧; }\n\n    const pairMap = new Map();      // key: prev+curr → token\n    const pairReverse = new Map();  // key: token → prev+curr\n\n    // تحميل من localStorage إذا موجود\n    const saved = JSON.parse(localStorage.getItem("ctxPairs")||"null");\n    let pairs = saved?.pairs || defaultPairs;\n\n    function rebuildPairs(){\n      pairMap.clear();\n      pairReverse.clear();\n      const used = new Set();\n      let idx = 0;\n      for(const [p,c] of pairs){\n        const k = p+"|"+c;\n        let inner;\n        // اختر رمزًا داخليًا غير مستخدم\n        while(idx < PAIR_INNER_SYMBOLS.length && used.has(PAIR_INNER_SYMBOLS[idx])) idx++;\n        inner = PAIR_INNER_SYMBOLS[idx % PAIR_INNER_SYMBOLS.length];\n        used.add(inner);\n        const token = wrapPairSymbol(inner);\n        pairMap.set(k, token);\n        pairReverse.set(token, k);\n        idx++;\n      }\n      localStorage.setItem("ctxPairs", JSON.stringify({pairs}));\n      renderPairs();\n    }\n\n    function renderPairs(){\n      const box = document.getElementById('pairsList');\n      if(!pairs.length){ box.textContent = 'لا توجد أزواج سياقية — استخدم الحقول أعلاه لإضافة واحد.'; return; }\n      box.innerHTML = pairs.map(([p,c],i)=><span class=\"pill\">${i+1}. <b>${p}</b> ثم <b>${c}</b> → رمز خاص</span>).join(' ');\n    }\n\n    rebuildPairs();\n\n    // ====== الدوال الأساسية ======\n    function encode(input){\n      const tokens = [];\n      let prev = null;\n      for(const ch of input){\n        // إذا الحرف غير موجود بالخريطة الأساسية سنحتفظ به كما هو داخل قوس خاص ليسهل فكّه\n        let baseToken = baseMap.get(ch);\n        if(!baseToken){ baseToken = ⟨${ch}⟩; }\n        if(prev !== null){\n          const key = prev+"|"+ch;\n          if(pairMap.has(key)){\n            // أضف الرمز الخاص للثاني\n            tokens.push(pairMap.get(key));\n          }else{\n            tokens.push(baseToken);\n          }\n        }else{\n          tokens.push(baseToken);\n        }\n        prev = ch;\n      }\n      return tokens.join(' ');\n    }\n\n    function decode(cipher){\n      const tokens = (cipher||"").trim().length ? cipher.split(/\s+/) : [];\n      let result = '';\n      let lastDecoded = null;\n      for(const t of tokens){\n        if(pairReverse.has(t)){\n          // هذا توكن زوجي يمثل الحرف الثاني فقط\n          const [p,c] = pairReverse.get(t).split('|');\n          // اختياري: التحقق من تطابق السابق\n          if(lastDecoded && lastDecoded !== p){\n            // إذا لا يطابق، نفترضه مستقلًا فقط بالثاني\n            result += c;\n          }else{\n            result += c;\n          }\n          lastDecoded = c;\n        }else if(t.startsWith('⟨') && t.endsWith('⟩')){\n          // محارف غير معروفة حُفظت كما هي\n          const ch = t.slice(1,-1);\n          result += ch;\n          lastDecoded = ch;\n        }else{\n          // توكن أساسي\n          const ch = baseReverse.get(t);\n          if(ch){\n            result += ch;\n            lastDecoded = ch;\n          }else{\n            // إذا لم نجد، نضعه كما هو (حماية من ضياع الرموز)\n            result += t;\n            lastDecoded = t;\n          }\n        }\n      }\n      return result;\n    }\n\n    // ====== ربط الواجهة ======\n    const $ = (id)=>document.getElementById(id);\n\n    $("encodeBtn").addEventListener('click', ()=>{\n      $("cipher").value = encode($("plain").value);\n    });\n    $("decodeBtn").addEventListener('click', ()=>{\n      $("plainOut").value = decode($("cipherIn").value);\n    });\n\n    $("copyCipher").addEventListener('click', async()=>{\n      const v = $("cipher").value; if(!v) return;\n      await navigator.clipboard.writeText(v);\n      flash($("copyCipher"), 'تم النسخ ✅');\n    });\n\n    $("copyPlain").addEventListener('click', async()=>{\n      const v = $("plainOut").value; if(!v) return;\n      await navigator.clipboard.writeText(v);\n      flash($("copyPlain"), 'تم النسخ ✅');\n    });\n\n    function flash(btn, text){\n      const old = btn.textContent; btn.textContent = text; btn.disabled = true;\n      setTimeout(()=>{btn.textContent = old; btn.disabled=false;}, 900);\n    }\n\n    $("addPair").addEventListener('click', ()=>{\n      const p = $("pairPrev").value?.trim();\n      const c = $("pairCurr").value?.trim();\n      if(!p || !c){ alert('املأ الحقلين لإضافة زوج سياقي'); return; }\n      pairs.push([p[0], c[0]]);\n      rebuildPairs();\n      $("pairPrev").value='';\n      $("pairCurr").value='';\n    });\n\n    // ====== أمثلة سريعة للتجربة ======\n    $("plain").value = "أنس 19 هز 2008-12-31";\n  </script>\n</body>\n</html>"}

