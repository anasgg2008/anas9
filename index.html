{"updates":[{"pattern":".","multiple":true,"replacement":"<!DOCTYPE html>\n<html lang="ar" dir="rtl">\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1" />\n  <title>تشفير / فك التشفير</title>\n  <style>\n    :root{--bg:#05070b;--txt:#eaf6ff;--neon:#39f;--neon2:#f39;--panel:#0b111a}\n    {box-sizing:border-box}\n    html,body{height:100%}\n    body{margin:0;background:radial-gradient(1200px 500px at 80% -20%,rgba(57,153,255,.08),transparent 60%),radial-gradient(1000px 500px at -10% 120%,rgba(243,57,153,.08),transparent 60%),var(--bg);color:var(--txt);font-family:"Cairo", system-ui, -apple-system, Segoe UI, Roboto, Noto Sans Arabic, Arial, sans-serif;display:flex;align-items:center;justify-content:center}\n    .wrap{width:min(980px,100%);padding:24px;display:grid;grid-template-columns:1fr;gap:22px}\n    .box{background:var(--panel);border:2px solid rgba(255,255,255,.06);border-radius:18px;padding:16px 16px 14px;box-shadow:0 0 12px rgba(57,153,255,.18) inset}\n    .box h2{margin:0 0 10px;font-size:18px;color:#a8cfff;text-shadow:0 0 8px var(--neon),0 0 18px var(--neon)}\n    .box:nth-child(2) h2{color:#ffaad5;text-shadow:0 0 8px var(--neon2),0 0 18px var(--neon2)}\n    textarea{width:100%;height:180px;background:#02050a;color:var(--txt);border:2px solid var(--neon);border-radius:14px;padding:12px 14px;font-size:15px;line-height:1.6;outline:none;box-shadow:0 0 16px rgba(57,153,255,.35),inset 0 0 24px rgba(57,153,255,.15)}\n    .box:nth-child(2) textarea{border-color:var(--neon2);box-shadow:0 0 16px rgba(243,57,153,.35),inset 0 0 24px rgba(243,57,153,.15)}\n    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}\n    .btn{appearance:none;border:none;border-radius:12px;padding:9px 14px;font-size:15px;background:linear-gradient(135deg,var(--neon),#83c5ff);color:#04121f;cursor:pointer}\n    .btn:active{transform:scale(.98)}\n    .btn.alt{background:linear-gradient(135deg,var(--neon2),#ff9ed2);color:#1a0512}\n  </style>\n  <link rel="preconnect" href="https://fonts.googleapis.com" />\n  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />\n  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500;700&display=swap" rel="stylesheet" />\n</head>\n<body>\n  <main class="wrap">\n    <section class="box">\n      <h2>🔐 هذه خانة التشفير</h2>\n      <textarea id="plain" placeholder="اكتب النص هنا"></textarea>\n      <div class="row">\n        <button id="enc" class="btn">تشفير</button>\n      </div>\n    </section>\n\n    <section class="box">\n      <h2>🗝️ هذه خانة فك التشفير</h2>\n      <textarea id="cipher" placeholder="ضع الرموز هنا"></textarea>\n      <div class="row">\n        <button id="dec" class="btn alt">فك التشفير</button>\n      </div>\n    </section>\n  </main>\n\n<script>(function(){\n  "use strict";\n  // ————————————————————————————————————————————————\n  // إعداد مجموعات الأحرف\n  // ————————————————————————————————————————————————\n  const A_AR = ["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","ء","أ","إ","آ","ى","ة","ؤ","ئ"];\n  const A_EN_L = "abcdefghijklmnopqrstuvwxyz".split("");\n  const A_EN_U = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");\n  const D_AR = ["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];\n  const D_EN = ["0","1","2","3","4","5","6","7","8","9"];\n  const SYM = [" ","/",".","_","]","[",")","(","-",",",";",":","?","!","\"","'","+","=","@","#","$","%","^","&","<",">","{","}","\\","|","~","`"];\n  // ملاحظة: النجمة * غير مشفرة — تُترك كما هي.\n\n  // ———————————— جداول الحروف للرموز ————————————\n  const CJK = ["中","国","天","日","月","火","水","木","金","土","山","川","心","文","王","玉","田","雨","風","花","草","虫","魚","鳥","雲","星","海","雪","電","龍","門","石","林","森","光","空","気","道","学","高","小","大","本","人","手","口","目","耳","足","力","心","語","時","先","生","社","校","車","音","図","画","新","古","長","短","早","多","少","白","黒","赤","青","緑","黄","紫","金","銀","銅","鉄","玉","宝","王","皇","天","京","北","南","東","西","中","外","内"];\n  const CYR = ["А","Б","В","Г","Д","Е","Ж","З","И","Й","К","Л","М","Н","О","П","Р","С","Т","У","Ф","Х","Ц","Ч","Ш","Щ","Ъ","Ы","Ь","Э","Ю","Я"];\n  const JPN = ["ア","イ","ウ","エ","オ","カ","キ","ク","ケ","コ","サ","シ","ス","セ","ソ","タ","チ","ツ","テ","ト","ナ","ニ","ヌ","ネ","ノ","ハ","ヒ","フ","ヘ","ホ","マ","ミ","ム","メ","モ","ヤ","ユ","ヨ","ラ","リ","ル","レ","ロ","ワ","ヲ","ン"];\n\n  // ———————————— توليد رموز ثابتة ————————————\n  function makeTokenBase(i){\n    const cj = CJK[i % CJK.length];\n    const cy = CYR[Math.floor(i / CJK.length) % CYR.length];\n    return cj + cy + "^"; // لاحقة ^ للرمز الأساسي\n  }\n  function makeTokenCtx(i, suffix){\n    const cj = CJK[i % CJK.length];\n    const cy = CYR[Math.floor(i / CJK.length) % CYR.length];\n    return cj + cy + suffix; // لاحقات خاصة للسياق\n  }\n  function makeTokenSym(i){\n    const jp = JPN[i % JPN.length];\n    return jp + ""; // لاحقة * للرموز\n  }\n\n  // بناء قائمة كل المحارف التي سنشفرها (عدا )\n  const BASE_CHARS = [...A_AR, ...A_EN_L, ...A_EN_U, ...D_AR, ...D_EN];\n  const ALL_CHARS = [...BASE_CHARS, ...SYM.filter(s=>s!=="")];\n\n  // خرائط التشفير الأساسية\n  const baseMap = Object.create(null);\n  const baseRev = Object.create(null);\n  for(let i=0;i<BASE_CHARS.length;i++){\n    const ch = BASE_CHARS[i];\n    const tk = makeTokenBase(i);\n    baseMap[ch] = tk;\n    baseRev[tk] = ch;\n  }\n\n  // خرائط الرموز (Symbols) — لاحقة * — ما عدا * نفسه\n  const symMap = Object.create(null);\n  const symRev = Object.create(null);\n  for(let i=0;i<SYM.length;i++){\n    const ch = SYM[i];\n    if(ch === "") continue; // النجمة غير مشفرة\n    const tk = makeTokenSym(i);\n    symMap[ch] = tk;\n    symRev[tk] = ch;\n  }\n\n  // ———————————— قواعد سياقية ————————————\n  // أي حرف يأتي بعد: س أو ن أو ا —> يأخذ رمزًا خاصًا (لاحقات مختلفة لكل حالة)\n  const CTX_TRIGGERS = { S:"س", N:"ن", A:"ا" };\n  const SUF_S = "᚜"; // لاحقة فريدة للسياق بعد س\n  const SUF_N = "᚛"; // لاحقة فريدة للسياق بعد ن\n  const SUF_A = "ᛯ"; // لاحقة فريدة للسياق بعد ا\n\n  const ctxS = Object.create(null), ctxN = Object.create(null), ctxA = Object.create(null);\n  const ctxSRev = Object.create(null), ctxNRev = Object.create(null), ctxARev = Object.create(null);\n\n  // ننشئ رموزًا خاصة لكل حرف أساسي يمكن أن يأتي بعد (س/ن/ا)\n  for(let i=0;i<BASE_CHARS.length;i++){\n    const ch = BASE_CHARS[i];\n    const tkS = makeTokenCtx(i, SUF_S);\n    const tkN = makeTokenCtx(i, SUF_N);\n    const tkA = makeTokenCtx(i, SUF_A);\n    ctxS[ch] = tkS; ctxSRev[tkS] = ch;\n    ctxN[ch] = tkN; ctxNRev[tkN] = ch;\n    ctxA[ch] = tkA; ctxARev[tkA] = ch;\n  }\n\n  // ———————————— دوال التشفير / فك التشفير ————————————\n  function encodeText(str){\n    const out = [];\n    let prev = "";\n    for(const ch of str){\n      if(ch === "") { out.push(""); prev = ch; continue; }\n      // رموز (symbols)\n      if(ch in symMap){ out.push(symMap[ch]); prev = ch; continue; }\n      // أحرف/أرقام\n      const baseTk = baseMap[ch];\n      if(!baseTk){ // غير معروف: نحفظه بين أقواس ليبقى قابلاً للاسترجاع\n        out.push("⟨"+ch+"⟩"); prev = ch; continue;\n      }\n      // قواعد سياقية\n      if(prev === CTX_TRIGGERS.S){ out.push(ctxS[ch]); prev = ch; continue; }\n      if(prev === CTX_TRIGGERS.N){ out.push(ctxN[ch]); prev = ch; continue; }\n      if(prev === CTX_TRIGGERS.A){ out.push(ctxA[ch]); prev = ch; continue; }\n      // عادي\n      out.push(baseTk); prev = ch;\n    }\n    return out.join(" ");\n  }\n\n  function decodeText(str){\n    if(!str) return "";\n    const toks = str.trim().split(/\s+/);\n    let out = "";\n    for(const t of toks){\n      if(t === "") { out += ""; continue; }\n      if(t in symRev){ out += symRev[t]; continue; }\n      if(t in ctxSRev){ out += ctxSRev[t]; continue; }\n      if(t in ctxNRev){ out += ctxNRev[t]; continue; }\n      if(t in ctxARev){ out += ctxARev[t]; continue; }\n      if(t in baseRev){ out += baseRev[t]; continue; }\n      if(t.startsWith("⟨") && t.endsWith("⟩")) { out += t.slice(1,-1); continue; }\n      // لو رمز غير معروف، نعيده كما هو\n      out += t;\n    }\n    return out;\n  }\n\n  // ———————————— ربط الأزرار ————————————\n  const $ = id=>document.getElementById(id);\n  Object.freeze(baseMap);Object.freeze(baseRev);Object.freeze(symMap);Object.freeze(symRev);\n  Object.freeze(ctxS);Object.freeze(ctxN);Object.freeze(ctxA);\n  Object.freeze(ctxSRev);Object.freeze(ctxNRev);Object.freeze(ctxARev);\n\n  $("enc").addEventListener("click", function(){\n    try{ $("cipher").value = encodeText($("plain").value); }catch(e){ /* صامت / }\n  }, {passive:true});\n\n  $("dec").addEventListener("click", function(){\n    try{ $("plain").value = decodeText($("cipher").value); }catch(e){ / صامت */ }\n  }, {passive:true});\n})();</script>\n</body>\n</html>"}]}

